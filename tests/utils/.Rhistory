library(Seurat)
filepath1 = "/home/shaoheng/Documents/data/hESC-droplet/GSE125416/GSM3573649_D_filtered_gene_bc_matrices_h5.h5"
filepath2 = "/home/shaoheng/Documents/data/hESC-droplet/GSE125416/GSM3573650_N_filtered_gene_bc_matrices_h5.h5"
mat1 <- Read10X_h5(filepath1)
mat2 <- Read10X_h5(filepath2)
obj = CreateSeuratObject(cbind(mat1, mat2), orig.ident=c(rep('normal', dim(mat1)[2]), rep('nicotine', dim(mat2)[2])), project='both')
obj = CreateSeuratObject(cbind(mat1, mat2), meta.data =c(rep('normal', dim(mat1)[2]), rep('nicotine', dim(mat2)[2])), project='both')
obj = CreateSeuratObject(cbind(mat1, mat2), meta.data = data.frame(c(rep('normal', dim(mat1)[2]), rep('nicotine', dim(mat2)[2]))), project='both')
library(Seurat)
filepath1 = "/home/shaoheng/Documents/data/hESC-droplet/GSE125416/GSM3573649_D_filtered_gene_bc_matrices_h5.h5"
filepath2 = "/home/shaoheng/Documents/data/hESC-droplet/GSE125416/GSM3573650_N_filtered_gene_bc_matrices_h5.h5"
mat1 <- Read10X_h5(filepath1)
mat2 <- Read10X_h5(filepath2)
obj = CreateSeuratObject(cbind(mat1, mat2), project='both')
obj$sample <- c(rep('normal', dim(mat1)[2]), rep('nicotine', dim(mat2)[2]))
obj
rm(mat1)
rm(mat2)
gc()
obj[["percent.mt"]] <- PercentageFeatureSet(obj, pattern = "^MT-")
VlnPlot(obj, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
obj <- subset(obj, subset = nFeature_RNA >= 200 & nFeature_RNA <= 6000 & percent.mt < 20)
obj
obj <- NormalizeData(obj)
obj <- FindVariableFeatures(obj, mean.cutoff = c(0.0125, 3), dispersion.cutoff = c(0.5, Inf))
obj <- CellCycleScoring(obj, s.features = cc.genes$s.genes, g2m.features = cc.genes$g2m.genes, set.ident = TRUE)
RidgePlot(obj, features = c("CCND1", "CCNE1", "CCNA2", "CCNB1"), ncol = 2)
RidgePlot(obj, features = c("MKI67", "TUBB4B"), ncol = 2)
obj <- ScaleData(obj, features = rownames(obj))
obj <- RunPCA(obj, features = VariableFeatures(object = obj))
DimPlot(obj)
DimPlot(obj, dims = c(2, 3), pt.size=0.1)
saveRDS(obj, "~/Documents/data/hESC-droplet/GSE125416/GSM357650-regular.RDS")
source("../utils/gsea.R")
mat2cls(as.matrix(obj@reductions$pca@cell.embeddings), "~/Documents/data/hESC-droplet/GSE125416/GSE125416-regular-pca.cls")
source("../utils/hdfrw.R")
mat2hdf(as.matrix(obj@assays$RNA@scale.data), "~/Documents/data/hESC-droplet/GSE125416/GSE125416-regular.h5")
